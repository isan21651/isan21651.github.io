<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MyBank ‚Äî Full Demo</title>
<style>
  :root{
    --bg1:#071428; --bg2:#0e4fa0; --glass: rgba(255,255,255,0.08);
    --accent:#08a0ff; --muted:#9fb6d9;
  }
  *{box-sizing:border-box}
  body{font-family:Inter, 'Segoe UI', Arial, sans-serif; margin:0; min-height:100vh;
    background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:#eef6ff; padding:20px;}
  .wrap{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:20px}
  .card{background:var(--glass);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.06);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.4)}
  h2{margin:6px 0 12px}
  input,select,textarea,button{font-size:14px;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.02);color:#eef6ff; width:100%}
  input::placeholder, textarea::placeholder{color:var(--muted)}
  button{cursor:pointer;background:linear-gradient(90deg,var(--accent),#00d1ff);border:0;color:#012;}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.12);color:#eaf6ff}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted)}
  .row{display:flex;gap:8px}
  .col{flex:1}
  table{width:100%;border-collapse:collapse;margin-top:10px;color:#012;background:transparent}
  th,td{padding:8px;border:1px solid rgba(255,255,255,0.06);font-size:13px;background:rgba(255,255,255,0.02)}
  th{background:rgba(255,255,255,0.06);color:#fff}
  img.avatar{width:68px;height:68px;border-radius:8px;object-fit:cover;border:1px solid rgba(255,255,255,0.08)}
  .hidden{display:none}
  .actions button{margin-right:6px;padding:6px 8px;font-size:13px}
  pre{white-space:pre-wrap;background:rgba(255,255,255,0.02);padding:8px;border-radius:6px;color:#eaf6ff}
  @media(max-width:980px){
    .wrap{grid-template-columns:1fr; padding-bottom:40px}
  }
</style>
</head>
<body>
<div class="wrap">

  <!-- LEFT: Auth / Apply / Admin Signup -->
  <div class="card" id="leftPanel">
    <h2>üè¶ MyBank Demo</h2>

    <div id="mainMenu">
      <button onclick="showCustomerLogin()">üë§ Customer Login</button>
      <button class="secondary" onclick="showApply()">üìù Apply for Account</button>
      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.06)"/>
      <p class="small muted">Admin? <a onclick="showAdminLogin()" style="color:var(--accent);cursor:pointer">Admin Login / Signup</a></p>
      <p class="muted small" id="stats">Loading...</p>
    </div>

    <!-- Apply form -->
    <div id="applyBox" class="hidden">
      <h3>Apply for Account</h3>
      <input id="appName" placeholder="Full name"/>
      <input id="appEmail" placeholder="Gmail"/>
      <input id="appPhone" placeholder="Phone"/>
      <input id="appNid" placeholder="NID number"/>
      <label class="small muted">Profile photo (optional)</label>
      <input id="appPhoto" type="file" accept="image/*"/>
      <textarea id="appAddress" placeholder="Address (optional)"></textarea>
      <div class="row" style="margin-top:6px">
        <button onclick="submitApplication()">Submit Application</button>
        <button class="secondary" onclick="backToMain()">Cancel</button>
      </div>
      <p class="small muted">Admin will review applications and approve. You'll get account number and initial password on approval.</p>
    </div>

    <!-- Customer Login -->
    <div id="custLoginBox" class="hidden">
      <h3>Customer Login</h3>
      <input id="custLoginEmail" placeholder="Email"/>
      <input id="custLoginPass" placeholder="Password" type="password"/>
      <div class="row" style="margin-top:6px">
        <button onclick="customerLogin()">Login</button>
        <button class="secondary" onclick="showApply()">Apply</button>
      </div>
      <p class="small muted">If approved, login using your email & password (admin sets initial password)</p>
      <button class="secondary" style="margin-top:10px" onclick="backToMain()">Back</button>
    </div>

    <!-- Admin Login / Signup -->
    <div id="adminLoginBox" class="hidden">
      <h3>Admin Login</h3>
      <input id="admLoginEmail" placeholder="Admin email"/>
      <input id="admLoginPass" placeholder="Password" type="password"/>
      <div class="row" style="margin-top:6px"><button onclick="adminLogin()">Login</button><button class="secondary" onclick="showAdminSignup()">Signup</button></div>
      <button class="secondary" style="margin-top:10px" onclick="backToMain()">Back</button>
    </div>

    <div id="adminSignupBox" class="hidden">
      <h3>Create Admin</h3>
      <input id="admSUname" placeholder="Name"/>
      <input id="admSUemail" placeholder="Email"/>
      <input id="admSUphone" placeholder="Phone"/>
      <input id="admSUpass" placeholder="Password" type="password"/>
      <div class="row" style="margin-top:6px"><button onclick="adminSignup()">Create Admin</button><button class="secondary" onclick="showAdminLogin()">Back</button></div>
    </div>

  </div>

  <!-- RIGHT: Dashboards -->
  <div class="card" id="rightPanel">
    <div id="landing">
      <h2>Welcome to MyBank Demo</h2>
      <p class="muted">Apply for account or login. Admin can approve applications and manage customers. All data stored locally in your browser (demo).</p>
      <p class="small muted">Account numbers start at <b>20032001</b>. Admin can edit balances, add deposit/withdraw records and delete accounts.</p>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminPanel" class="hidden">
      <h2>üëë Admin Panel</h2>
      <div class="row" style="align-items:center">
        <div class="col"><b id="admNameDisplay"></b><div class="small muted" id="admEmailDisplay"></div></div>
        <div><button class="secondary" onclick="adminLogout()">Logout</button></div>
      </div>

      <h3 style="margin-top:12px">Pending Applications</h3>
      <table>
        <thead><tr><th>#</th><th>Name</th><th>Email</th><th>Phone</th><th>NID</th><th>Photo</th><th>Applied At</th><th>Actions</th></tr></thead>
        <tbody id="applyTbody"></tbody>
      </table>

      <h3 style="margin-top:12px">Customers</h3>
      <table>
        <thead><tr><th>Serial</th><th>Account</th><th>Name</th><th>NID</th><th>Phone</th><th>Balance</th><th>Actions</th></tr></thead>
        <tbody id="custTbody"></tbody>
      </table>
    </div>

    <!-- Customer Dashboard -->
    <div id="userPanel" class="hidden">
      <div style="display:flex;gap:12px;align-items:center">
        <img id="userPhoto" class="avatar" src="" alt="photo" style="display:none"/>
        <div>
          <h2 id="uName">Name</h2>
          <div class="small muted" id="uAccount">Account#</div>
        </div>
        <div style="margin-left:auto"><button class="secondary" onclick="userLogout()">Logout</button></div>
      </div>

      <h3 id="uBalance">Balance: 0‡ß≥</h3>
      <div class="row">
        <div class="col"><button onclick="userDeposit()">Deposit</button></div>
        <div class="col"><button onclick="userWithdraw()">Withdraw</button></div>
        <div class="col"><button onclick="userSend()">Send</button></div>
      </div>

      <h4 style="margin-top:12px">Transaction History</h4>
      <div id="uHistory"></div>

      <h4 style="margin-top:12px">Profile</h4>
      <label class="small muted">Change photo</label>
      <input id="userPhotoInput" type="file" accept="image/*"/>
      <div class="row" style="margin-top:6px"><button onclick="changePhoto()">Upload Photo</button><button class="secondary" onclick="downloadStatement()">Download Statement</button></div>
    </div>

    <!-- User login after approval (alternate) -->
    <div id="userLoginBox" class="hidden">
      <h3>Customer Login</h3>
      <input id="loginEmail" placeholder="Email"/>
      <input id="loginPass" type="password" placeholder="Password"/>
      <div class="row" style="margin-top:6px"><button onclick="customerLogin()">Login</button><button class="secondary" onclick="backToMain()">Back</button></div>
      <p class="small muted">If you don't have password, admin provides initial password on approval.</p>
    </div>

  </div>

</div>

<script>
/* ================= Storage keys & init ================ */
function load(key, def){ try{ const v=localStorage.getItem(key); return v?JSON.parse(v):def }catch(e){return def} }
function save(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

let apps = load('mb_apps', []);           // pending applications
let users = load('mb_users', []);         // approved users
let admins = load('mb_admins', []);       // admin accounts
let lastAcc = load('mb_lastAcc', 20032000); // will increment before assign
let session = load('mb_session', null);   // {role:'admin'|'user', id:email or account}

save('mb_apps', apps); save('mb_users', users); save('mb_admins', admins); save('mb_lastAcc', lastAcc);

/* ================ UI helpers ================= */
function el(id){ return document.getElementById(id) }
function backToMain(){ hideAllLeft(); hideAllRight(); el('mainMenu').style.display='block'; el('landing').classList.remove('hidden'); }
function hideAllLeft(){
  ['mainMenu','applyBox','custLoginBox','adminLoginBox','adminSignupBox'].forEach(i=>el(i).classList.add('hidden'));
}
function hideAllRight(){
  ['landing','adminPanel','userPanel','userLoginBox'].forEach(i=>el(i).classList.add('hidden'));
}
function showApply(){ hideAllLeft(); el('applyBox').classList.remove('hidden'); hideAllRight(); el('landing').classList.add('hidden'); }
function showCustomerLogin(){ hideAllLeft(); el('custLoginBox').classList.remove('hidden'); hideAllRight(); el('landing').classList.add('hidden'); }
function showAdminLogin(){ hideAllLeft(); el('adminLoginBox').classList.remove('hidden'); hideAllRight(); el('landing').classList.add('hidden'); }
function showAdminSignup(){ hideAllLeft(); el('adminSignupBox').classList.remove('hidden'); hideAllRight(); el('landing').classList.add('hidden'); }
function showUserLoginBox(){ hideAllLeft(); hideAllRight(); el('userLoginBox').classList.remove('hidden'); }

/* ================= Helpers ================= */
function nextAccount(){
  lastAcc = Number(load('mb_lastAcc', lastAcc)) + 1;
  save('mb_lastAcc', lastAcc);
  return String(lastAcc);
}
function findUserByEmail(email){ return users.find(u=>u.email===email) }
function findUserByAccount(acc){ return users.find(u=>u.account===acc) }
function refreshStats(){ el('stats').innerText = `Pending: ${apps.length} ‚Ä¢ Customers: ${users.length} ‚Ä¢ Admins: ${admins.length}` }

/* ================= Application flow ================= */
function submitApplication(){
  const name = el('appName').value.trim();
  const email = el('appEmail').value.trim().toLowerCase();
  const phone = el('appPhone').value.trim();
  const nid = el('appNid').value.trim();
  const address = el('appAddress').value.trim();
  if(!name||!email||!phone||!nid) return alert('‡¶®‡¶æ‡¶Æ, Gmail, ‡¶´‡ßã‡¶® ‡¶ì NID ‡¶¶‡¶ø‡¶®');
  if(users.find(u=>u.email===email) || apps.find(a=>a.email===email)) return alert('‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶Ü‡¶ó‡ßá ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá');
  const file = el('appPhoto').files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      const photoData = e.target.result;
      const id = 'A'+Date.now().toString().slice(-6);
      apps.push({ id, name, email, phone, nid, address, photo:photoData, appliedAt: new Date().toLocaleString() });
      save('mb_apps', apps); alert('Application submitted'); clearApplyForm(); refreshStats(); backToMain();
    }
    reader.readAsDataURL(file);
  } else {
    const id = 'A'+Date.now().toString().slice(-6);
    apps.push({ id, name, email, phone, nid, address, photo:null, appliedAt: new Date().toLocaleString() });
    save('mb_apps', apps); alert('Application submitted'); clearApplyForm(); refreshStats(); backToMain();
  }
}
function clearApplyForm(){ ['appName','appEmail','appPhone','appNid','appAddress'].forEach(i=>el(i).value=''); el('appPhoto').value=''; }

/* ================= Admin functions ================= */
function adminSignup(){
  const name = el('admSUname').value.trim();
  const email = el('admSUemail').value.trim().toLowerCase();
  const phone = el('admSUphone').value.trim();
  const pass = el('admSUpass').value;
  if(!name||!email||!phone||!pass) return alert('‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®');
  if(admins.find(a=>a.email===email)) return alert('‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá admin ‡¶Ü‡¶õ‡ßá');
  admins.push({ name, email, phone, pass });
  save('mb_admins', admins);
  alert('Admin account created ‚Äî Login now');
  el('admSUname').value=''; el('admSUemail').value=''; el('admSUphone').value=''; el('admSUpass').value='';
  showAdminLogin(); refreshStats();
}
function adminLogin(){
  const email = el('admLoginEmail').value.trim().toLowerCase();
  const pass = el('admLoginPass').value;
  const a = admins.find(x=>x.email===email && x.pass===pass);
  if(!a) return alert('Admin credentials wrong. If no admin exists, create one.');
  session = { role:'admin', id: a.email }; save('mb_session', session);
  showAdminPanel();
}
function adminLogout(){ session=null; localStorage.removeItem('mb_session'); location.reload(); }

/* render admin panel */
function showAdminPanel(){
  hideAllLeft(); hideAllRight(); el('adminPanel').classList.remove('hidden');
  const a = admins.find(x=>x.email===session.id);
  el('admNameDisplay').innerText = a? a.name : session.id; el('admEmailDisplay').innerText = a? `${a.email} ‚Ä¢ ${a.phone}` : '';
  renderApplications(); renderCustomers(); refreshStats();
}
function renderApplications(){
  const tbody = el('applyTbody'); tbody.innerHTML='';
  apps.forEach((app,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td>${app.name}</td><td>${app.email}</td><td>${app.phone}</td><td>${app.nid}</td>
      <td>${app.photo?'<img src="'+app.photo+'" class="avatar">':'-'}</td><td>${app.appliedAt}</td>
      <td>
        <button onclick="approveApp('${app.id}')">Approve</button>
        <button class="secondary" onclick="rejectApp('${app.id}')">Reject</button>
      </td>`;
    tbody.appendChild(tr);
  });
}
function approveApp(id){
  const idx = apps.findIndex(a=>a.id===id); if(idx<0) return alert('Application not found');
  const app = apps[idx];
  const account = nextAccount();
  const serial = users.length + 1;
  const initialPass = Math.random().toString(36).slice(-6);
  const user = {
    serial, account, name: app.name, email: app.email, phone: app.phone, nid: app.nid, address: app.address || '',
    photo: app.photo || null, balance: 0, password: initialPass,
    history: [`Account created on ${new Date().toLocaleString()} | initial password: ${initialPass}`]
  };
  users.push(user);
  apps.splice(idx,1);
  save('mb_users', users); save('mb_apps', apps);
  alert(`Approved. Account#: ${account}\nInitial password: ${initialPass}\nTell the customer to login with email and this password.`);
  renderApplications(); renderCustomers(); refreshStats();
}
function rejectApp(id){
  const idx = apps.findIndex(a=>a.id===id); if(idx<0) return alert('Application not found');
  if(!confirm('Reject this application?')) return;
  apps.splice(idx,1); save('mb_apps', apps); renderApplications(); refreshStats();
}
function renderCustomers(){
  const tbody = el('custTbody'); tbody.innerHTML='';
  users.forEach(u=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.serial}</td><td>${u.account}</td><td>${u.name}</td><td>${u.nid}</td><td>${u.phone}</td><td>${u.balance}‡ß≥</td>
      <td>
        <button onclick="adminEditBalance('${u.account}')">Edit</button>
        <button onclick="adminTransaction('${u.account}')">Deposit/Withdraw</button>
        <button onclick="adminViewHistory('${u.account}')">History</button>
        <button class="secondary" onclick="adminDelete('${u.account}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  });
}
function adminEditBalance(account){
  const u = findUserByAccount(account); if(!u) return alert('Not found');
  const val = prompt(`Set new balance for ${u.name} (current ${u.balance}‡ß≥):`, u.balance);
  const x = parseFloat(val); if(isNaN(x)) return alert('Invalid number');
  u.history.push(`Balance changed from ${u.balance}‡ß≥ to ${x}‡ß≥ by admin on ${new Date().toLocaleString()}`);
  u.balance = x; save('mb_users', users); renderCustomers();
}
function adminTransaction(account){
  const u = findUserByAccount(account); if(!u) return alert('Not found');
  const type = prompt('Type: deposit or withdraw').toLowerCase();
  const amt = parseFloat(prompt('Amount (‡ß≥):'));
  if(isNaN(amt) || amt<=0) return alert('Invalid amount');
  if(type==='deposit'){ u.balance += amt; u.history.push(`+${amt}‡ß≥ Deposited by admin on ${new Date().toLocaleString()}`); }
  else if(type==='withdraw'){ if(amt>u.balance) return alert('Insufficient balance'); u.balance -= amt; u.history.push(`-${amt}‡ß≥ Withdrawn by admin on ${new Date().toLocaleString()}`);}
  else return alert('Invalid type');
  save('mb_users', users); renderCustomers();
}
function adminViewHistory(account){
  const u = findUserByAccount(account); if(!u) return alert('Not found');
  const w = window.open('','_blank','width=700,height=600'); w.document.write(`<h3>History for ${u.name} (Acc ${u.account})</h3><pre style="white-space:pre-wrap">${u.history.join('\n\n')}</pre>`);
}
function adminDelete(account){
  if(!confirm('Delete account permanently?')) return;
  const idx = users.findIndex(x=>x.account===account); if(idx<0) return alert('Not found');
  users.splice(idx,1); users.forEach((u,i)=>u.serial=i+1); save('mb_users', users); renderCustomers(); refreshStats();
}

/* ================= Customer functions ================= */
function customerLogin(){
  const email = el('custLoginEmail').value.trim().toLowerCase();
  const pass = el('custLoginPass').value;
  const u = users.find(x=>x.email===email && x.password===pass);
  if(!u) return alert('Credentials wrong or account not approved yet');
  session = { role:'user', id: u.account }; save('mb_session', session); showUserPanel();
}
function showUserPanel(){
  hideAllLeft(); hideAllRight(); el('userPanel').classList.remove('hidden');
  const u = findUserByAccount(session.id); if(!u) return alert('User session error');
  el('uName').innerText = u.name; el('uAccount').innerText = `Account#: ${u.account} ‚Ä¢ Serial: ${u.serial}`; el('uBalance').innerText = `Balance: ${u.balance}‡ß≥`;
  el('uHistory').innerHTML = u.history.slice().reverse().map(h=>`<pre>${h}</pre>`).join('');
  if(u.photo){ el('userPhoto').src = u.photo; el('userPhoto').style.display='block'; } else { el('userPhoto').style.display='none'; }
  refreshStats();
}
function userDeposit(){
  const amt = parseFloat(prompt('Deposit amount (‡ß≥):')); if(isNaN(amt)||amt<=0) return alert('Invalid');
  const u = findUserByAccount(session.id); u.balance += amt; u.history.push(`+${amt}‡ß≥ Deposited on ${new Date().toLocaleString()}`); save('mb_users', users); showUserPanel();
}
function userWithdraw(){
  const amt = parseFloat(prompt('Withdraw amount (‡ß≥):')); const u = findUserByAccount(session.id);
  if(isNaN(amt)||amt<=0) return alert('Invalid'); if(amt>u.balance) return alert('Insufficient');
  u.balance -= amt; u.history.push(`-${amt}‡ß≥ Withdrawn on ${new Date().toLocaleString()}`); save('mb_users', users); showUserPanel();
}
function userSend(){
  const toAcc = prompt('Recipient Account Number:'); const amt = parseFloat(prompt('Amount (‡ß≥):'));
  if(!toAcc || isNaN(amt)||amt<=0) return alert('Invalid'); const u = findUserByAccount(session.id); const r = findUserByAccount(toAcc.trim());
  if(!r) return alert('Recipient not found'); if(amt>u.balance) return alert('Insufficient');
  u.balance -= amt; r.balance += amt;
  const now = new Date().toLocaleString();
  u.history.push(`-${amt}‡ß≥ Sent to ${r.account} (${r.name}) on ${now}`); r.history.push(`+${amt}‡ß≥ Received from ${u.account} (${u.name}) on ${now}`);
  save('mb_users', users); showUserPanel();
}
function userLogout(){ session=null; localStorage.removeItem('mb_session'); location.reload(); }

/* change/upload photo for logged user */
function changePhoto(){
  const f = el('userPhotoInput').files[0]; if(!f) return alert('Choose an image file');
  const reader = new FileReader(); reader.onload = function(e){
    const u = findUserByAccount(session.id); u.photo = e.target.result; save('mb_users', users); showUserPanel();
    alert('Photo updated');
  }; reader.readAsDataURL(f);
}

/* download user's statement (simple) */
function downloadStatement(){
  const u = findUserByAccount(session.id); if(!u) return alert('Not found');
  const text = `Statement for ${u.name} (Acc ${u.account})\n\n` + u.history.join('\n\n');
  const blob = new Blob([text], {type:'text/plain'}); const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `statement_${u.account}.txt`; a.click(); URL.revokeObjectURL(url);
}

/* ================= Misc (boot) ================= */
function boot(){
  apps = load('mb_apps', apps); users = load('mb_users', users); admins = load('mb_admins', admins);
  lastAcc = load('mb_lastAcc', lastAcc); session = load('mb_session', session);
  refreshStats();
  // default UI: if no admins exist, show admin signup area
  hideAllLeft(); hideAllRight();
  if(!session){ el('mainMenu').style.display='block'; el('landing').classList.remove('hidden'); } 
  if(session){
    if(session.role==='admin') showAdminPanel();
    else if(session.role==='user') showUserPanel();
  }
}
boot();

</script>
</body>
</html>
